---
title: "Creating a private link to Oracle"

---

A typical evaluation scenario is to use an existing Oracle infrastructure for the front end and PostgreSQL for reporting purposes. This setup helps evaluate PostgreSQL without risking the production environment.

## Setting up a private link to a remote Oracle server from an private cluster in Azure

Assume that your cluster is on an Azure subscription called *test* and is being linked to an Oracle virtual machine deployed in the France Central region with the following details. 

-   Cluster:
    -   Region: *Japan East*
    -   Virtual Network: *vnet-japaneast*
    -   Subscription: *test*
    -   Cluster ID: *p-c4j0jfcmp3af2ieok5eg* 
    -   Account ID: *brcxzr08qr7rbei1* 
    -   Organization's domain name: *biganimal.io* 

-   Oracle client VM called *client-vm*:
    -   Port: *1555*
    -   Region: *France Central*
    -   Subscription: *development*
    -   Resource group: *rg-client*
    -   Virtual network: *vnet-client*
    -   Virtual network subnet: *snet-client*

### Step 1: Create a standard load balancer for Oracle's virtual network

1. In the search box at the top of the portal, enter Load balancer. Select **Load balancers** in the search results.

1. In the Load balancer page, select **Create**.

1. In the Basics tab of the Create load balancer page, enter, or select the following information:
   1. Select the subscription (**development**) and the resource group (**rg-client**), on which the Oracle's virtual machine is deployed.
   2. Select **France Central**, the region where Oracle's virtual machine is deployed. 
   3. Select the **Standard** SKU.
   4. Select Type as **Internal**.
1. In the Frontend IP configuration tab, select **+Add a frontend IP configuration**, and select the same virtual network (**vnet-client**) and subnet (**snet-client**) details used for deploying Oracle's virtual machine.
1. In the Backend pools tab, select **+ Add a backend pool**.
   1. Select **+Add** and add the virtual machine (**client-vm**) on which the Oracle database is deployed. 
1. In the Inbound rules tab, select **Add a load balancing rule**.
   1. Select the Frontend IP address and Backend pool created previously in this procedure. 
   1. Enter the Oracle port (**1555**) as the backend port.
   1. Under Health Probe, select **Create new** and configure the criterion for which the instance can be considered healthy and receive traffic.
1. After adding the load balancing rule is listed in the Inbound rules tab.
1. Select **Review + create** and **Create**.


### Step 2: Create an Azure Private Link service for your cluster

In this example, you create an [Azure Private Link service](https://docs.microsoft.com/en-us/azure/private-link/private-link-service-overview) in your cluster's resource group. You must perform this procedure for every cluster that you want to connect to in Azure.

1.  Get the resource group details from the Azure CLI or the Azure portal and note the resource group name. For example, if the cluster's virtual network is *vnet-japaneast*, use the following command: 

    ```shell
      $ az network vnet list --query "[?name==\`vnet-japaneast\`].resourceGroup" -o json

    ```

2.  On the upper-left part of the page in the Azure portal, select **Create a resource**.

3.  In the **Search the Marketplace** box, search for *Private Link*.

4.  Select **Create**.

5.  Enter the details for the Azure Private Link. Use a unique name for the Azure Private Link. 

    For example, *p-c4j0jfcmp3af2ieok5eg-service-private-link*, where *p-c4j0jfcmp3af2ieok5eg* is the cluster ID. 

     ![Create private link service](../images/image5.png)

6.  Enter the resource group name from step 1. 

7.  In the **Outbound settings** page, select the Load balancer and Load balancer frontend IP address created above.

8.  On the **Access security** page, configure the level of access for the private link service. See [control service exposure](https://docs.microsoft.com/en-us/azure/private-link/private-link-service-overview#control-service-exposure) for details.

    ![](../images/image21.png)  

    !!! Note
        If the required access is not provided to the account or subscription accessing the cluster, you must manually approve the connection request from the **Pending connections** page in **Private Link Center**.


9.  After the private link service is created, note its alias. The alias is the unique ID for your private service, which you can share with the service consumers. Obtain the alias either from the Azure portal or by using the following CLI command:

    ```shell
      $ az network private-link-service list --query "[?name=='p-c4j0jfcmp3af2ieok5eg-service-private-link'].alias" -o tsv
      p-c4j0jfcmp3af2ieok5eg-service-private-link.48f26b42-45dc-4e80-8e3d-307d58d7d274.japaneast.azure.privatelinkservice
    ```

10. Select **Review + Create**.

11. Select **Create**.

### Step 3: Create an Azure Private Endpoint in each client virtual network

  In this example, you create an Azure Private Endpoint in your client VM's virtual network. After you create the private endpoint, you can use its private IP address to access the cluster. You must perform this procedure for every virtual network you want to connect from.

1.  On the upper-left side of the screen in the Azure portal, select **Create a resource > Networking > Private Link**, or in the search box enter *Private Link*.

2.  Select **Create**.

3.  In Private Link Center, select **Private endpoints** in the menu on the left.

4.  In Private endpoints, select **Add**.

5.  Enter the details for the private endpoint as shown in the following image. Use a unique name for the private endpoint. 

    For example, enter *vnet-client-private-pg-service*, where *vnet-client* is the client VNet ID. 

    !!! Note
        In a later step, you need the private endpoint's name to get its private IP address.

    ![](../images/image12.png)

6.  Connect the private endpoint to the private link service that you created by entering its alias.

    ![](../images/image17.png)

7.  In the **Configuration** page, enter the client VM's Virtual Network *vnet-client*.

8.  Select **Review + Create**.

9.  Select **Create**.

    !!!Note
       If the private endpoint's status appears as **Pending**, your account or subscription might not be authorized to access the private link service. 

       To resolve this issue, the connection must be manually approved from the Pending connections page in Private Link Center, from the BigAnimal Azure subscription.

    !!!


10. You have successfully built a tunnel between your client VM's virtual network and the cluster. You can now access the cluster from the private endpoint in your client VM. The private endpoint's private IP address is associated with an independent virtual network NIC. Get the private endpoint's private IP address using the following commands:

    ```shell
     $ NICID=$(az network private-endpoint show -n vnet-client-private-pg-service -g rg-client --query "networkInterfaces[0].id" -o tsv)
     $ az network nic show -n ${NICID##*/} -g rg-client --query "ipConfigurations[0].privateIpAddress" -o tsv
     100.64.111.5
    ```

11. From the client VM *vm-client*, access the cluster by using the private IP address:

    ```shell
    $ psql -h 100.64.111.5 -U edb_admin 

    Password for user edb_admin : 

    psql (13.4 (Ubuntu 13.4-1.pgdg20.04+1), server 13.4.8 (Debian 13.4.8-1+deb10)) 
    WARNING : psql major version 13, server major version 13. Some psql features might not work. 
    SSL connection (protocol : TLSV1.3, cipher : TLS_AES_256_GCM_SHA384, bits : 256, compression : off) Type "help" for help. 

    edb_admin=>

    ```